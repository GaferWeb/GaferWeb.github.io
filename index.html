<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MaUd ‚Äî –Ø–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å –ò–ò</title>
  <style>
    :root {
      --bg-color: #0a0a0a;
      --element-bg: #1a1a1a;
      --accent-color: #8b5cf6;
      --text-color: #ffffff;
      --overlay-color: rgba(0, 0, 0, 0.6);
    }
    [data-theme="light"] {
      --bg-color: #f5f5f5;
      --element-bg: #e5e5e5;
      --accent-color: #7c3aed;
      --text-color: #000000;
      --overlay-color: rgba(0, 0, 0, 0.3);
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      overflow-x: hidden;
      position: relative;
      min-height: 100vh;
    }
    #splash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--bg-color);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: opacity 0.5s ease;
    }
    #splash.hidden {
      opacity: 0;
      pointer-events: none;
    }
    #splash-logo {
      font-size: 4rem;
      font-weight: 800;
      background: linear-gradient(to top, transparent 50%, var(--accent-color) 50%);
      background-size: 100% 200%;
      background-position: bottom;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: fillLogo 2s ease-in-out forwards;
    }
    @keyframes fillLogo {
      to {
        background-position: top;
      }
    }
    #splash-subtitle {
      margin-top: 1rem;
      font-size: 1.2rem;
      opacity: 0.8;
    }
    #background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }
    .ball {
      position: absolute;
      border-radius: 50%;
      filter: blur(20px);
      opacity: 0.4;
      animation: float 20s infinite ease-in-out, color 30s infinite linear;
    }
    @keyframes float {
      0%, 100% { transform: translate(0, 0) scale(1); }
      25% { transform: translate(10px, -10px) scale(1.05); }
      50% { transform: translate(-10px, 10px) scale(0.95); }
      75% { transform: translate(15px, 5px) scale(1.02); }
    }
    @keyframes color {
      0% { filter: hue-rotate(0deg) blur(20px); }
      100% { filter: hue-rotate(360deg) blur(20px); }
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
      position: relative;
      z-index: 10;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 0;
    }
    .logo {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--accent-color);
      transition: color 0.3s ease;
    }
    .logo.generating {
      color: #60a5fa;
    }
    .theme-toggle, .menu-toggle {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-color);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cursor {
      position: fixed;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: rgba(139, 92, 246, 0.5);
      pointer-events: none;
      transform: translate(-50%, -50%);
      z-index: 9999;
      transition: transform 0.1s ease;
    }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--overlay-color);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      z-index: 998;
    }
    .overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .menu {
      position: fixed;
      top: 0;
      right: -300px;
      width: 280px;
      height: 100%;
      background-color: var(--element-bg);
      padding: 2rem 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      z-index: 999;
      transition: right 0.3s ease;
    }
    .menu.active {
      right: 0;
    }
    .menu-back {
      align-self: flex-start;
      background: none;
      border: none;
      font-size: 1.8rem;
      cursor: pointer;
      color: var(--text-color);
    }
    .menu-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .menu-button {
      background: var(--accent-color);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    .settings-panel {
      position: fixed;
      top: 0;
      right: -300px;
      width: 280px;
      height: 100%;
      background-color: var(--element-bg);
      padding: 2rem 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      z-index: 999;
      transition: right 0.3s ease;
    }
    .settings-panel.active {
      right: 0;
    }
    .settings-content {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .language-header, .cursor-header {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .language-option {
      padding: 0.75rem 0;
      cursor: pointer;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .language-option.active {
      position: relative;
    }
    .language-option.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100%;
      height: 3px;
      background-color: var(--accent-color);
      border-radius: 2px;
    }
    .color-picker-button {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.3);
      cursor: pointer;
      background-color: rgba(139, 92, 246, 0.5);
    }
    .size-slider-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .size-slider-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .size-slider-value {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    .size-slider {
      width: 100%;
      height: 5px;
      background: #ccc;
      border-radius: 5px;
      outline: none;
      -webkit-appearance: none;
    }
    .size-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--accent-color);
      cursor: pointer;
    }
    .size-slider::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--accent-color);
      cursor: pointer;
      border: none;
    }
    .main-interface, .chat-interface {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
      padding-top: 2rem;
    }
    .chat-interface {
      display: none;
      width: 100%;
      height: calc(100vh - 120px);
      flex-direction: column;
    }
    .chat-interface.active {
      display: flex;
    }
    .input-area {
      width: 100%;
      max-width: 600px;
    }
    textarea {
      width: 100%;
      padding: 1rem;
      background-color: rgba(26, 26, 26, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: var(--text-color);
      font-size: 1.1rem;
      resize: none;
      min-height: 60px;
      backdrop-filter: blur(10px);
    }
    [data-theme="light"] textarea {
      background-color: rgba(229, 229, 229, 0.6);
      border-color: rgba(0, 0, 0, 0.1);
    }
    .response-area {
      width: 100%;
      max-width: 600px;
      padding: 1.5rem;
      background-color: rgba(26, 26, 26, 0.4);
      border-radius: 12px;
      min-height: 100px;
      backdrop-filter: blur(10px);
      line-height: 1.6;
    }
    [data-theme="light"] .response-area {
      background-color: rgba(229, 229, 229, 0.6);
    }
    .chat-messages {
      flex: 1;
      width: 100%;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .message {
      max-width: 80%;
      padding: 0.75rem 1rem;
      border-radius: 12px;
      line-height: 1.5;
    }
    .user-message {
      align-self: flex-end;
      background-color: var(--element-bg);
    }
    .ai-message {
      align-self: flex-start;
      background-color: var(--element-bg);
      border-left: 3px solid var(--accent-color);
    }
    .chat-input-area {
      display: flex;
      gap: 0.5rem;
      width: 100%;
      padding: 0 1rem 1rem;
    }
    .chat-input {
      flex: 1;
      padding: 0.75rem;
      background-color: var(--element-bg);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: var(--text-color);
    }
    [data-theme="light"] .chat-input {
      border-color: rgba(0, 0, 0, 0.1);
    }
    .send-button {
      background-color: var(--accent-color);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.75rem 1.25rem;
      cursor: pointer;
      font-weight: 600;
    }
    .new-dialog-button {
      background: none;
      border: 1px solid var(--accent-color);
      color: var(--accent-color);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 1rem;
    }
    .sidebar {
      position: fixed;
      top: 0;
      left: -300px;
      width: 280px;
      height: 100%;
      background-color: var(--element-bg);
      padding: 2rem 1.5rem;
      display: flex;
      flex-direction: column;
      z-index: 997;
      transition: left 0.3s ease;
    }
    .sidebar.active {
      left: 0;
    }
    .sidebar-header {
      background-color: #8A2BE2;
      color: white;
      padding: 0.75rem;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .sidebar-chat-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      flex: 1;
    }
    .sidebar-chat-item {
      padding: 0.75rem;
      cursor: pointer;
      border-radius: 6px;
      transition: background-color 0.2s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    [data-theme="dark"] .sidebar-chat-item:hover {
      background-color: #f5f5f5;
    }
    [data-theme="light"] .sidebar-chat-item:hover {
      background-color: #dcdcdc;
    }
    .sidebar-chat-delete {
      background: none;
      border: none;
      color: #ff4d4d;
      cursor: pointer;
      font-size: 1.2rem;
      padding: 0.25rem;
    }
    .sidebar-toggle {
      position: fixed;
      top: 50%;
      left: 0;
      transform: translateY(-50%);
      background-color: var(--element-bg);
      border: 1px solid var(--accent-color);
      color: var(--accent-color);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 996;
      transition: left 0.3s ease;
    }
    .sidebar-toggle.active {
      left: 280px;
    }
    .sidebar-toggle.hidden {
      display: none;
    }
    .back-to-menu-button {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      margin: 0;
    }
    .auth-button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }
    .login-button {
      background-color: #8b5cf6;
      color: white;
      margin-bottom: 0.5rem;
    }
    .register-button {
      background-color: #808080;
      color: white;
      transform: scale(0.9);
    }
    .error-message {
      color: #ff4d4d;
      font-size: 0.8rem;
      margin-top: 0.25rem;
      display: none;
    }
    .error-input {
      border: 1px solid #ff4d4d !important;
    }
    .typing-indicator {
      display: inline-block;
      padding: 10px 15px;
      background-color: var(--element-bg);
      border-radius: 12px;
      border-left: 3px solid var(--accent-color);
    }
    .typing-dots {
      display: inline-block;
    }
    .typing-dots span {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: var(--accent-color);
      margin: 0 2px;
      animation: typing 1.4s infinite ease-in-out;
    }
    .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
    .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes typing {
      0%, 80%, 100% {
        transform: scale(0.8);
        opacity: 0.5;
      }
      40% {
        transform: scale(1);
        opacity: 1;
      }
    }
    .api-key-input {
      width: 100%;
      padding: 0.5rem;
      background-color: var(--element-bg);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      color: var(--text-color);
      margin-top: 0.5rem;
    }
    .api-key-save {
      background-color: var(--accent-color);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      margin-top: 0.5rem;
      font-weight: 600;
    }
    .api-key-status {
      font-size: 0.8rem;
      margin-top: 0.5rem;
      padding: 0.25rem;
      border-radius: 4px;
    }
    .api-key-status.valid {
      background-color: rgba(0, 255, 0, 0.1);
      color: #00ff00;
    }
    .api-key-status.invalid {
      background-color: rgba(255, 0, 0, 0.1);
      color: #ff4d4d;
    }
  </style>
</head>
<body data-theme="dark">
  <div id="splash">
    <div id="splash-logo">MaUd</div>
    <div id="splash-subtitle">–ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</div>
  </div>
  <div id="background"></div>
  <div class="cursor" id="customCursor"></div>
  <div class="overlay" id="overlay"></div>
  
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <button class="back-to-menu-button" id="backToMenuButton">‚Üê</button>
      <span>–í–∞—à–∏ —á–∞—Ç—ã</span>
      <span></span>
    </div>
    <div class="sidebar-chat-list" id="sidebarChatList"></div>
  </div>
  
  <button class="sidebar-toggle" id="sidebarToggle">‚Üí</button>
  
  <nav class="menu" id="menu">
    <button class="menu-back" id="menuBack">√ó</button>
    <div class="menu-item">
      <span>–ê–∫–∫–∞—É–Ω—Ç</span>
      <button class="menu-button" id="openAccountModal">–û—Ç–∫—Ä—ã—Ç—å</button>
    </div>
    <div class="menu-item">
      <span>–†–µ–∂–∏–º —á–∞—Ç–∞</span>
      <button class="menu-button" id="toggleChatMode">–í–∫–ª—é—á–∏—Ç—å</button>
    </div>
    <div class="menu-item">
      <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
      <button class="menu-button" id="openSettingsFromMenu">–û—Ç–∫—Ä—ã—Ç—å</button>
    </div>
    <div class="menu-item">
      <span>–û –Ω–∞—Å</span>
      <button class="menu-button" id="viewBlog">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</button>
    </div>
    <div class="menu-item">
      <span>API –∫–ª—é—á</span>
      <button class="menu-button" id="openApiKeyModal">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å</button>
    </div>
  </nav>
  
  <div class="settings-panel" id="settingsPanel">
    <button class="menu-back" id="settingsBack">‚Üê</button>
    <div class="settings-content">
      <div class="language-header">–Ø–∑—ã–∫</div>
      <div class="language-option active" data-lang="ru">–†—É—Å—Å–∫–∏–π</div>
      <div class="language-option" data-lang="en">English</div>
      <div class="language-option" data-lang="es">Espa√±ol</div>
      <div class="cursor-header">–ö—Ä—É–≥–ª—ã–π –∫—É—Ä—Å–æ—Ä</div>
      <div class="menu-item">
        <span>–¶–≤–µ—Ç</span>
        <div class="color-picker-button" id="colorPickerButton"></div>
        <input type="color" id="colorPicker" style="display: none;">
      </div>
      <div class="size-slider-container">
        <div class="size-slider-label">
          <span>–†–∞–∑–º–µ—Ä</span>
          <span class="size-slider-value" id="sizeSliderValue">1.0x</span>
        </div>
        <input type="range" min="-3" max="3" step="0.1" value="0" class="size-slider" id="sizeSlider">
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API –∫–ª—é—á–∞ -->
  <div class="overlay" id="apiKeyOverlay" style="display: none;">
    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: var(--element-bg); padding: 2rem; border-radius: 12px; width: 90%; max-width: 500px; z-index: 1001;">
      <h3 style="margin-bottom: 1rem;">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–∞</h3>
      <p style="margin-bottom: 1rem; font-size: 0.9rem; opacity: 0.8;">
        –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ò–ò –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –≤–∞—à API –∫–ª—é—á. –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ OpenAI.
      </p>
      <input type="password" class="api-key-input" id="apiKeyInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à API –∫–ª—é—á">
      <div class="api-key-status" id="apiKeyStatus"></div>
      <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
        <button class="api-key-save" id="saveApiKey">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="new-dialog-button" id="closeApiKeyModal">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <div class="container">
    <header>
      <button class="theme-toggle" id="themeToggle">‚òÄÔ∏è</button>
      <div class="logo" id="mainLogo">MaUd</div>
      <button class="menu-toggle" id="menuToggle">‚ò∞</button>
    </header>
    
    <div class="main-interface" id="mainInterface">
      <div class="input-area">
        <textarea id="mainInput" placeholder="–°–ø—Ä–æ—Å–∏—Ç–µ —É –ò–ò..."></textarea>
      </div>
      <div class="response-area" id="mainResponse">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –æ—Ç–≤–µ—Ç –æ—Ç –ò–ò.</div>
      <button class="new-dialog-button" id="newDialogMain">–ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥</button>
    </div>
    
    <div class="chat-interface" id="chatInterface">
      <div class="chat-messages" id="chatMessages">
        <div class="message ai-message">–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç MaUd. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?</div>
      </div>
      <div class="chat-input-area">
        <input type="text" class="chat-input" id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
        <button class="send-button" id="sendButton">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
      <button class="new-dialog-button" id="newDialogChat">–ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
      
      // API –∫–ª—é—á –¥–ª—è Gemini (–±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ localStorage)
      let API_KEY = localStorage.getItem('maud_api_key') || "";
      const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`;

      // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
      const splash = document.getElementById('splash');
      const customCursor = document.getElementById('customCursor');
      const themeToggle = document.getElementById('themeToggle');
      const menuToggle = document.getElementById('menuToggle');
      const menuBack = document.getElementById('menuBack');
      const settingsBack = document.getElementById('settingsBack');
      const overlay = document.getElementById('overlay');
      const menu = document.getElementById('menu');
      const openSettingsFromMenu = document.getElementById('openSettingsFromMenu');
      const settingsPanel = document.getElementById('settingsPanel');
      const toggleChatMode = document.getElementById('toggleChatMode');
      const mainInterface = document.getElementById('mainInterface');
      const chatInterface = document.getElementById('chatInterface');
      const mainInput = document.getElementById('mainInput');
      const mainResponse = document.getElementById('mainResponse');
      const chatInput = document.getElementById('chatInput');
      const chatMessages = document.getElementById('chatMessages');
      const sendButton = document.getElementById('sendButton');
      const newDialogMain = document.getElementById('newDialogMain');
      const newDialogChat = document.getElementById('newDialogChat');
      const mainLogo = document.getElementById('mainLogo');
      const viewBlog = document.getElementById('viewBlog');
      const colorPickerButton = document.getElementById('colorPickerButton');
      const colorPicker = document.getElementById('colorPicker');
      const sizeSlider = document.getElementById('sizeSlider');
      const sizeSliderValue = document.getElementById('sizeSliderValue');
      const sidebar = document.getElementById('sidebar');
      const sidebarToggle = document.getElementById('sidebarToggle');
      const backToMenuButton = document.getElementById('backToMenuButton');
      const sidebarChatList = document.getElementById('sidebarChatList');
      const openApiKeyModal = document.getElementById('openApiKeyModal');
      const apiKeyOverlay = document.getElementById('apiKeyOverlay');
      const apiKeyInput = document.getElementById('apiKeyInput');
      const saveApiKey = document.getElementById('saveApiKey');
      const closeApiKeyModal = document.getElementById('closeApiKeyModal');
      const apiKeyStatus = document.getElementById('apiKeyStatus');

      // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
      let isCursorEnabled = true;
      let selectedCursorColor = 'rgba(139, 92, 246, 0.5)';
      let cursorSize = 0;
      let isChatMode = false;
      let currentChatId = null;
      let chats = {};

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è splash —ç–∫—Ä–∞–Ω–∞
      function hideSplash() {
        console.log('–°–∫—Ä—ã—Ç–∏–µ splash —ç–∫—Ä–∞–Ω–∞...');
        if (splash) {
          splash.classList.add('hidden');
          setTimeout(function() {
            splash.style.display = 'none';
            console.log('Splash —ç–∫—Ä–∞–Ω —Å–∫—Ä—ã—Ç');
          }, 500);
        }
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫—É—Ä—Å–æ—Ä–∞
      function initCursor() {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫—É—Ä—Å–æ—Ä–∞...');
        
        function updateCursor() {
          if (isCursorEnabled) {
            customCursor.style.display = 'block';
            customCursor.style.backgroundColor = selectedCursorColor;
            const baseSize = 20;
            const scaleFactor = Math.pow(1.5, cursorSize);
            const newSize = baseSize * scaleFactor;
            customCursor.style.width = newSize + 'px';
            customCursor.style.height = newSize + 'px';
            document.body.style.cursor = 'none';
          } else {
            customCursor.style.display = 'none';
            document.body.style.cursor = 'default';
          }
        }

        document.addEventListener('mousemove', function(e) {
          if (isCursorEnabled && customCursor) {
            customCursor.style.left = e.clientX + 'px';
            customCursor.style.top = e.clientY + 'px';
          }
        });

        document.addEventListener('mousedown', function() {
          if (isCursorEnabled) {
            customCursor.style.transform = 'translate(-50%, -50%) scale(0.8)';
          }
        });

        document.addEventListener('mouseup', function() {
          if (isCursorEnabled) {
            customCursor.style.transform = 'translate(-50%, -50%) scale(1)';
          }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫—É—Ä—Å–æ—Ä–∞
        colorPickerButton.addEventListener('click', function() {
          colorPicker.click();
        });

        colorPicker.addEventListener('change', function(e) {
          selectedCursorColor = e.target.value;
          colorPickerButton.style.backgroundColor = selectedCursorColor;
          updateCursor();
        });

        sizeSlider.addEventListener('input', function() {
          cursorSize = parseFloat(sizeSlider.value);
          const scaleFactor = Math.pow(1.5, cursorSize);
          sizeSliderValue.textContent = scaleFactor.toFixed(1) + 'x';
          updateCursor();
        });

        updateCursor();
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Gemini API
      async function getAIResponse(message, isChat = false, chatHistory = []) {
        console.log('–ó–∞–ø—Ä–æ—Å –∫ Gemini API...');
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è API –∫–ª—é—á–∞
        if (!API_KEY) {
          return "–û—à–∏–±–∫–∞: API –∫–ª—é—á –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –µ–≥–æ –≤ –º–µ–Ω—é.";
        }
        
        mainLogo.classList.add('generating');
        
        try {
          let prompt = "–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç MaUd. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –ë—É–¥—å –≤–µ–∂–ª–∏–≤—ã–º –∏ –ø–æ–ª–µ–∑–Ω—ã–º.\n\n";
          
          if (isChat && chatHistory.length > 0) {
            const recentHistory = chatHistory.slice(-6);
            recentHistory.forEach(msg => {
              if (msg.isUser) {
                prompt += "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: " + msg.text + "\n";
              } else {
                prompt += "–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: " + msg.text + "\n";
              }
            });
          }
          
          prompt += "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: " + message + "\n–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç:";

          const requestBody = {
            contents: [{
              parts: [{
                text: prompt
              }]
            }],
            generationConfig: {
              temperature: 0.7,
              maxOutputTokens: 1000,
            }
          };

          const response = await fetch(GEMINI_API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(requestBody)
          });

          if (!response.ok) {
            throw new Error('–û—à–∏–±–∫–∞ API: ' + response.status);
          }

          const data = await response.json();
          
          if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts[0]) {
            const aiResponse = data.candidates[0].content.parts[0].text;
            mainLogo.classList.remove('generating');
            return aiResponse;
          } else {
            throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç API");
          }

        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ Gemini:", error);
          mainLogo.classList.remove('generating');
          return "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑. –û—à–∏–±–∫–∞: " + error.message;
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –Ω–∞–±–æ—Ä–∞
      function createTypingIndicator() {
        const typingElement = document.createElement('div');
        typingElement.className = 'message ai-message typing-indicator';
        typingElement.innerHTML = '<div class="typing-dots"><span></span><span></span><span></span></div>';
        return typingElement;
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
      async function handleMainInput(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          const text = mainInput.value.trim();
          if (text) {
            mainResponse.textContent = "–î—É–º–∞—é...";
            try {
              const aiResponse = await getAIResponse(text, false);
              mainResponse.textContent = aiResponse;
              mainInput.value = '';
            } catch (error) {
              mainResponse.textContent = "–û—à–∏–±–∫–∞: " + error.message;
            }
          }
        }
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —á–∞—Ç–∞
      async function handleChatInput() {
        const text = chatInput.value.trim();
        if (text) {
          // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          const userMessage = document.createElement('div');
          userMessage.className = 'message user-message';
          userMessage.textContent = text;
          chatMessages.appendChild(userMessage);
          
          chatInput.value = '';
          
          // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
          const typingIndicator = createTypingIndicator();
          chatMessages.appendChild(typingIndicator);
          
          // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
          chatMessages.scrollTop = chatMessages.scrollHeight;
          
          try {
            // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç –ò–ò
            const aiResponse = await getAIResponse(text, true, chats[currentChatId]?.messages || []);
            
            // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
            typingIndicator.remove();
            const aiMessage = document.createElement('div');
            aiMessage.className = 'message ai-message';
            aiMessage.textContent = aiResponse;
            chatMessages.appendChild(aiMessage);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            if (currentChatId && chats[currentChatId]) {
              chats[currentChatId].messages.push(
                { text: text, isUser: true },
                { text: aiResponse, isUser: false }
              );
              // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
              chats[currentChatId].title = text.length > 30 ? text.substring(0, 30) + "..." : text;
              localStorage.setItem('maud_chats', JSON.stringify(chats));
              updateSidebarChats();
            }
            
          } catch (error) {
            typingIndicator.remove();
            const errorMessage = document.createElement('div');
            errorMessage.className = 'message ai-message';
            errorMessage.textContent = "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.";
            chatMessages.appendChild(errorMessage);
          }
          
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤ –≤ —Å–∞–π–¥–±–∞—Ä–µ
      function updateSidebarChats() {
        sidebarChatList.innerHTML = '';
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º —á–∞—Ç—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
        const sortedChats = Object.values(chats).sort((a, b) => b.timestamp - a.timestamp);
        
        sortedChats.forEach(chat => {
          const chatItem = document.createElement('div');
          chatItem.className = 'sidebar-chat-item';
          chatItem.textContent = chat.title;
          
          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —á–∞—Ç–∞
          chatItem.addEventListener('click', () => {
            loadChat(chat.id);
            sidebar.classList.remove('active');
            sidebarToggle.classList.remove('active');
            sidebarToggle.textContent = '‚Üí';
          });
          
          // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —á–∞—Ç–∞
          const deleteButton = document.createElement('button');
          deleteButton.className = 'sidebar-chat-delete';
          deleteButton.textContent = '√ó';
          deleteButton.addEventListener('click', (e) => {
            e.stopPropagation();
            deleteChat(chat.id);
          });
          
          chatItem.appendChild(deleteButton);
          sidebarChatList.appendChild(chatItem);
        });
      }
      
      // –ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞
      function loadChat(chatId) {
        if (chats[chatId]) {
          currentChatId = chatId;
          chatMessages.innerHTML = '';
          
          chats[chatId].messages.forEach(msg => {
            const messageElement = document.createElement('div');
            messageElement.className = msg.isUser ? 'message user-message' : 'message ai-message';
            messageElement.textContent = msg.text;
            chatMessages.appendChild(messageElement);
          });
          
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
      }
      
      // –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞
      function deleteChat(chatId) {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —á–∞—Ç?')) {
          delete chats[chatId];
          localStorage.setItem('maud_chats', JSON.stringify(chats));
          updateSidebarChats();
          
          // –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —á–∞—Ç, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
          if (currentChatId === chatId) {
            startNewChat();
          }
        }
      }

      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
      function switchToChatMode() {
        isChatMode = true;
        mainInterface.style.display = 'none';
        chatInterface.classList.add('active');
        sidebar.classList.add('active');
        sidebarToggle.classList.add('active');
        sidebarToggle.classList.remove('hidden');
        sidebarToggle.textContent = '‚Üê';
        toggleChatMode.textContent = '–í—ã–∫–ª—é—á–∏—Ç—å';
        
        if (!currentChatId) {
          startNewChat();
        }
        
        updateSidebarChats();
      }

      function switchToMainMode() {
        isChatMode = false;
        chatInterface.classList.remove('active');
        mainInterface.style.display = 'flex';
        sidebar.classList.remove('active');
        sidebarToggle.classList.remove('active');
        sidebarToggle.classList.add('hidden');
        sidebarToggle.textContent = '‚Üí';
        toggleChatMode.textContent = '–í–∫–ª—é—á–∏—Ç—å';
        currentChatId = null;
      }

      function startNewChat() {
        const newChatId = 'chat_' + Date.now();
        currentChatId = newChatId;
        chats[newChatId] = {
          id: newChatId,
          title: '–ù–æ–≤—ã–π —á–∞—Ç',
          messages: [{ text: "–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç MaUd. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?", isUser: false }],
          timestamp: Date.now()
        };
        chatMessages.innerHTML = '';
        const welcomeMessage = document.createElement('div');
        welcomeMessage.className = 'message ai-message';
        welcomeMessage.textContent = "–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç MaUd. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?";
        chatMessages.appendChild(welcomeMessage);
        localStorage.setItem('maud_chats', JSON.stringify(chats));
        updateSidebarChats();
      }

      // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
      function openMenu() {
        menu.classList.add('active');
        overlay.classList.add('active');
      }

      function closeMenu() {
        menu.classList.remove('active');
        overlay.classList.remove('active');
      }

      function openSettingsPanel() {
        settingsPanel.classList.add('active');
        overlay.classList.add('active');
        menu.classList.remove('active');
      }

      function closeSettingsPanel() {
        settingsPanel.classList.remove('active');
        overlay.classList.remove('active');
      }

      function toggleTheme() {
        const currentTheme = document.body.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        document.body.setAttribute('data-theme', newTheme);
        themeToggle.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      }

      // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–æ–º
      function openApiKeyModal() {
        apiKeyOverlay.style.display = 'block';
        apiKeyInput.value = API_KEY;
        closeMenu();
      }

      function closeApiKeyModal() {
        apiKeyOverlay.style.display = 'none';
        apiKeyStatus.textContent = '';
        apiKeyStatus.className = 'api-key-status';
      }

      function saveApiKeyHandler() {
        const newApiKey = apiKeyInput.value.trim();
        if (newApiKey) {
          API_KEY = newApiKey;
          localStorage.setItem('maud_api_key', API_KEY);
          apiKeyStatus.textContent = 'API –∫–ª—é—á —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!';
          apiKeyStatus.className = 'api-key-status valid';
        } else {
          apiKeyStatus.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á';
          apiKeyStatus.className = 'api-key-status invalid';
        }
      }

      // –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ–Ω–æ–≤—ã—Ö —à–∞—Ä–æ–≤
      function createBackgroundBalls() {
        const background = document.getElementById('background');
        if (!background) return;
        
        const ballCount = 15;
        for (let i = 0; i < ballCount; i++) {
          const ball = document.createElement('div');
          ball.className = 'ball';
          const size = 60 + Math.random() * 100;
          ball.style.width = size + 'px';
          ball.style.height = size + 'px';
          ball.style.left = Math.random() * 90 + '%';
          ball.style.top = Math.random() * 90 + '%';
          ball.style.background = 'hsl(' + Math.floor(Math.random() * 360) + ', 70%, 60%)';
          ball.style.animation = 'float ' + (15 + Math.random() * 15) + 's infinite ease-in-out, color ' + (20 + Math.random() * 20) + 's infinite linear';
          background.appendChild(ball);
        }
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      function initializeApp() {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
        
        // –°–∫—Ä—ã–≤–∞–µ–º splash —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(hideSplash, 2000);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫—É—Ä—Å–æ—Ä–∞
        initCursor();
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ–Ω–∞
        createBackgroundBalls();
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤ –∏–∑ localStorage
        const storedChats = localStorage.getItem('maud_chats');
        if (storedChats) {
          try {
            chats = JSON.parse(storedChats);
          } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤:', e);
          }
        }

        // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        mainInput.addEventListener('keydown', handleMainInput);
        sendButton.addEventListener('click', handleChatInput);
        chatInput.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            handleChatInput();
          }
        });
        
        themeToggle.addEventListener('click', toggleTheme);
        menuToggle.addEventListener('click', openMenu);
        menuBack.addEventListener('click', closeMenu);
        settingsBack.addEventListener('click', closeSettingsPanel);
        overlay.addEventListener('click', function() {
          closeMenu();
          closeSettingsPanel();
        });
        
        openSettingsFromMenu.addEventListener('click', openSettingsPanel);
        
        toggleChatMode.addEventListener('click', function() {
          closeMenu();
          if (isChatMode) {
            switchToMainMode();
          } else {
            switchToChatMode();
          }
        });
        
        viewBlog.addEventListener('click', function() {
          window.open('https://maud-site.blogspot.com/', '_blank');
        });
        
        newDialogMain.addEventListener('click', function() {
          mainInput.value = '';
          mainResponse.textContent = '–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –æ—Ç–≤–µ—Ç –æ—Ç –ò–ò.';
        });
        
        newDialogChat.addEventListener('click', startNewChat);
        
        sidebarToggle.addEventListener('click', function() {
          sidebar.classList.toggle('active');
          sidebarToggle.classList.toggle('active');
          sidebarToggle.textContent = sidebar.classList.contains('active') ? '‚Üê' : '‚Üí';
        });
        
        backToMenuButton.addEventListener('click', function() {
          sidebar.classList.remove('active');
          sidebarToggle.classList.remove('active');
          sidebarToggle.textContent = '‚Üí';
        });
        
        openApiKeyModal.addEventListener('click', openApiKeyModal);
        closeApiKeyModal.addEventListener('click', closeApiKeyModal);
        saveApiKey.addEventListener('click', saveApiKeyHandler);
        
        apiKeyOverlay.addEventListener('click', function(e) {
          if (e.target === apiKeyOverlay) {
            closeApiKeyModal();
          }
        });

        console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
      }

      // –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
      initializeApp();
    });
  </script>
</body>
</html>
